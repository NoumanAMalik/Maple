import type { LanguageRules } from "../types";

/**
 * TypeScript/JavaScript language rules.
 * Shared between .ts, .tsx, .js, .jsx, .mjs, .cjs files.
 */
export const typescriptRules: LanguageRules = {
    name: "typescript",

    keywords: new Set([
        // Declarations
        "var",
        "let",
        "const",
        "function",
        "class",
        "interface",
        "type",
        "enum",
        "namespace",
        "module",
        "declare",
        "abstract",

        // Control flow
        "if",
        "else",
        "switch",
        "case",
        "default",
        "for",
        "while",
        "do",
        "break",
        "continue",
        "return",
        "throw",
        "try",
        "catch",
        "finally",

        // Operators & keywords
        "new",
        "delete",
        "typeof",
        "instanceof",
        "in",
        "of",
        "void",
        "yield",
        "await",
        "async",

        // Modifiers
        "public",
        "private",
        "protected",
        "static",
        "readonly",
        "override",
        "get",
        "set",

        // Import/Export
        "import",
        "export",
        "from",
        "as",
        "extends",
        "implements",

        // Other
        "this",
        "super",
        "debugger",
        "with",

        // TypeScript specific
        "keyof",
        "infer",
        "is",
        "asserts",
        "satisfies",
        "using",
    ]),

    // Operators sorted by length (longest first) for greedy matching
    operators: [
        // 4 characters
        ">>>=",
        // 3 characters
        ">>>",
        ">>=",
        "<<=",
        "**=",
        "||=",
        "&&=",
        "??=",
        "===",
        "!==",
        "...",
        // 2 characters
        "=>",
        "++",
        "--",
        "**",
        "==",
        "!=",
        ">=",
        "<=",
        ">>",
        "<<",
        "&&",
        "||",
        "??",
        "+=",
        "-=",
        "*=",
        "/=",
        "%=",
        "&=",
        "|=",
        "^=",
        "?.",
        "::",
        // 1 character
        "+",
        "-",
        "*",
        "/",
        "%",
        "&",
        "|",
        "^",
        "~",
        "!",
        "?",
        ":",
        "<",
        ">",
        "=",
        ".",
    ],

    punctuation: new Set(["(", ")", "[", "]", "{", "}", ";", ",", "@"]),

    constants: new Set(["true", "false", "null", "undefined", "NaN", "Infinity"]),

    builtins: new Set([
        // Global objects
        "console",
        "Math",
        "JSON",
        "Object",
        "Array",
        "String",
        "Number",
        "Boolean",
        "Date",
        "RegExp",
        "Error",
        "Map",
        "Set",
        "WeakMap",
        "WeakSet",
        "Promise",
        "Symbol",
        "Proxy",
        "Reflect",
        "BigInt",
        "ArrayBuffer",
        "DataView",
        "Int8Array",
        "Uint8Array",
        "Uint8ClampedArray",
        "Int16Array",
        "Uint16Array",
        "Int32Array",
        "Uint32Array",
        "Float32Array",
        "Float64Array",
        "BigInt64Array",
        "BigUint64Array",
        // Global functions
        "eval",
        "isFinite",
        "isNaN",
        "parseFloat",
        "parseInt",
        "decodeURI",
        "decodeURIComponent",
        "encodeURI",
        "encodeURIComponent",
        // TypeScript utility types
        "Partial",
        "Required",
        "Readonly",
        "Record",
        "Pick",
        "Omit",
        "Exclude",
        "Extract",
        "NonNullable",
        "Parameters",
        "ConstructorParameters",
        "ReturnType",
        "InstanceType",
        "ThisParameterType",
        "OmitThisParameter",
        "ThisType",
        "Awaited",
    ]),

    lineComment: "//",
    blockCommentStart: "/*",
    blockCommentEnd: "*/",

    stringDelimiters: ["'", '"', "`"],
    escapeChar: "\\",

    identifierStart: /[a-zA-Z_$]/,
    identifierPart: /[a-zA-Z0-9_$]/,
};

// JavaScript uses the same rules (subset of TypeScript)
export const javascriptRules: LanguageRules = {
    ...typescriptRules,
    name: "javascript",
};
